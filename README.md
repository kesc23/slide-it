# WooCommerce Product By Category

### Author: Kesc23
| Twitter | Fiverr |
|-|-:|
| [@kevin_esc23](https://twitter.com/kevin_esc23) | [/kesc23](https://fiverr.com/kesc23)|

### Version 0.7.2
#### Changelog

- HOTFIX *(Again)*

An error was generated by calling a hoook in a non-canonical way. It was causing WP to throw a FATAL ERROR.
Now solved ;)

##### Version 0.7.1
###### Changelog

- HOTFIX

An error while loading scripts to wp was causing it to throw a FATAL ERROR.
Now solved ;)

#### Version 0.7.0
##### Changelog

- Changed admin style from 'style.css' to 'style.php'

Altough this seems like a strange idea, i kinda couldn't work my way to add styles
in the WPC admin page inside WordPress.

The method used was by means of using action hooks from WP.

As i can print out info from php code inside the admin page i thought *i can work my way **creating a function to print style***

```php
/**
 * This function adds a stylesheet to the WPC admin page.
 *
 * @since 0.7.0
 * 
 * @return string returns the style for admin page
 */
function wpc_admin_style()
{
    $wpc_admin_style = '
      // Style inside
    ';

    //returns a HTML style tag to print the stylesheet inline
    return '<style>' . $wpc_admin_style . '</style>';
}
?>
```

Then, all i need to do is echo out this function inside my admin page:

```php
/*inside adminpage.php*/

require_once WPCADMIN . 'style.php';
echo wpc_admin_style();
```

- Added a shortcode generation form

Inside the *"Product by Category"* tab in WordPress, now you'll have
the Shorcode generation form.

With this form, you'll be able to set the Category, Products to show, Ordering by name *"Ascending" or "Descending"*.

After, if everything is alright, it will prompt the shortcode for you to put inside a page, post and etc.


- Added a function to display the generated shortcode inside the WPC tab.

After the shortcode is successfully generated by the form and the page reloads,
this function returns 2 things: a message, saying that 'this is the shortcode generated'.
Right below it, there's the shortcode itself, that the user can get and put in the site.

Here's the function's code

```php

/**
 * Function to display the shortcode in the admin page.
 * 
 * @since 0.7.0
 *
 * @return string returns the shotcode field
 */
function wpc_display_shortcode()
{
    if ( isset($_POST['cat-name']) && isset($_POST['num-p']))
    {
        if ( $_POST['cat-name'] == '' || $_POST['cat-name'] == null )
        {
            // returns error if category name is not set
            return do_action( 'admin_messages' , 'Categoria não inserida', 'error');
        
        } elseif ( $_POST['num-p'] <= -2 )
        {
            // returns error if num-p is less than 2. -1 has a role.
            return do_action( 'admin_messages' , 'Número Inválido' , 'error');
        
        } else {
        
            return do_action( 'admin_messages' , 'Esse é o seu shortcode. insira-o na página desejada', 'updated') .
            '
            <div class="wpc-shortcode-field">
                <p id="wpc-short-text">[WPC_PRODUCT_SHORTCODE cat-name="' . $_POST['cat-name'] . '" num-p=' . $_POST["num-p"] . '" p-order="' . $_POST["p-order"] .'"]</p>
                <span class="wpc-copy" data-clipboard-action="copy" data-clipboard-target="#wpc-short-text" style="cursor: pointer;">
                    <i class="far fa-clipboard"></i>
                </span>
            </div>
            ';
        
        }
    }
}

```

Inside the WPC page, there's a call to this function:

```php
/*Somewhere in the file*/
echo wpc_display_shortcode();
```

- Added a function that returns the product categories
inside a HTML `<options>` tag

In my efforts to help the user to get the right shortcode
i included a way to put in a list option, the retrieved info from the WP_Term Class in WP Core.

```php
/**
 * Show Category list function.
 * 
 * @since 0.7.0
 * 
 * @return string       Queries inside the WP DB and retrieve the
 *                      product categories inside an array.
 *                      Then returns it inside a option HTML tag
 *                      to be put inside a datalist.
 */
function wpc_show_categories()
{
    /**
     * This routine is to access the Product Categories
     * from WooCommerce inside the Database.
     */
    $wpc_cat_list = get_categories(
        array(
            'taxonomy'=> 'product_cat'
        )
    );

    /**
     * We can access the object from WP_Term Class inside an array.
     * print_r($wpc_cat_list[1])
     */

    $wpc_catname_datalist = ''; //The variable for the datalist.

    for($i=1; @is_object($wpc_cat_list[$i]); $i++)
    {   
        if ( empty($wpc_cat_list[$i]))
        {
            return;
        } else {
            $wpc_catname_datalist .= '<option value="' . $wpc_cat_list[$i]->to_array()['name'] . '">';
        }
    }
    return $wpc_catname_datalist;
}
```

- Added Clipboard JS Library to improve shortcode delivery

Aiming for the best user experience, adding a clipboard functionality
is good to help the things to go as faster as it can, while i don't add the WP Block functionality (which involves JS, *not my strenght at all*)

- Shortcode is now 100% functional

After more reading in the WP CODEX, i finally understood how to apply
the attributes to the shortcode.

So, right now you can use this plugin and it will work perfectly. 
altough the generation form needs little improvement, this can now be added to the sites with no fear.

The ordering of your products can be made by

- ***name,* Ascending or Descending**,
- **Category name**
- **Numer of Products**

```php
function wpc_shortcode_container( string|array $atts )
{
    $atts = shortcode_atts(
        array(
            'cat-name'      => '',
            'num-p'         => 5,
            'p-order'       => 'ASC'
        ), $atts );
    
    ...

}
```
